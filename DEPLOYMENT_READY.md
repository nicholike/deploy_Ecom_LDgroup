# âœ… Deployment Ready - Railway Automation

## ğŸ¯ What's Been Done

### âœ… Cleaned Up
- Removed **26+ unnecessary .md documentation files**
- Removed historical bug reports and test reports
- Removed redundant deployment guides
- Cleaned up frontend documentation clutter

### âœ… Created Automation Tools
1. **`deploy-railway.sh`** - Full automation script
   - Auto-generates JWT secrets
   - Creates Railway project
   - Adds MySQL database
   - Configures all environment variables
   - Deploys backend automatically

2. **`verify-deployment.sh`** - Deployment verification
   - Health check
   - Database connection test
   - CORS configuration check
   - Authentication test
   - SePay webhook security test
   - Readiness check

3. **`backend/.railwayignore`** - Optimized deployment
   - Excludes dev files from deployment
   - Reduces build size and time

4. **`DEPLOY.md`** - Quick start guide
   - Auto-deploy instructions
   - Manual deploy alternative
   - Troubleshooting tips

5. **`README.md`** - Project overview
   - Complete project documentation
   - Tech stack overview
   - Development setup
   - Deployment guides

---

## ğŸš€ How to Deploy

### Method 1: One-Command Auto-Deploy (Recommended)

```bash
# Make sure you're logged in to Railway
railway login

# Run the automation script
./deploy-railway.sh
```

The script will prompt you for:
- Project name (default: mlm-ecommerce-backend)
- SePay API key
- Bank account details
- Virtual account number

Everything else is automated! âœ¨

### Method 2: Manual Deploy

See **[DEPLOY.md](./DEPLOY.md)** for step-by-step manual instructions.

---

## ğŸ“‹ What the Automation Does

1. âœ… **Prerequisites Check**
   - Verifies Railway CLI is installed
   - Checks if logged in to Railway
   - Verifies Git repository

2. âœ… **Security Setup**
   - Generates cryptographically secure JWT secrets (32 bytes)
   - Creates unique JWT_SECRET and JWT_REFRESH_SECRET

3. âœ… **Railway Project**
   - Creates new Railway project with your chosen name
   - Links to your GitHub repository

4. âœ… **Database Setup**
   - Adds MySQL database service
   - Railway auto-injects DATABASE_URL

5. âœ… **Environment Configuration**
   - Sets 20+ environment variables
   - Configures production settings
   - Sets up payment integration (SePay)
   - Configures commission rates

6. âœ… **Code Deployment**
   - Commits and pushes code changes
   - Deploys to Railway
   - Monitors deployment status

7. âœ… **Post-Deploy Info**
   - Provides backend URL
   - Shows next steps
   - Gives useful commands

---

## ğŸ” Verify Deployment

After deployment completes, run:

```bash
./verify-deployment.sh
```

Enter your Railway backend URL when prompted.

The script will test:
- âœ… Health check endpoint
- âœ… Database connection
- âœ… CORS configuration
- âœ… Authentication enforcement
- âœ… SePay webhook security
- âœ… Application readiness

---

## ğŸ“Š Environment Variables (Auto-Configured)

The automation script sets these variables:

### Application
```bash
NODE_ENV=production
PORT=3000
API_PREFIX=/api/v1
```

### Security (Auto-Generated)
```bash
JWT_SECRET=<auto-generated-32-bytes>
JWT_REFRESH_SECRET=<auto-generated-32-bytes>
JWT_EXPIRES_IN=1d
JWT_REFRESH_EXPIRES_IN=7d
BCRYPT_SALT_ROUNDS=12
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100
```

### Payment (From Your Input)
```bash
SEPAY_API_KEY=<your-key>
BANK_ACCOUNT_NUMBER=<your-account>
BANK_ACCOUNT_NAME=<your-name>
BANK_CODE=<your-bank>
SEPAY_VA_NUMBER=<your-va>
SEPAY_VA_ACCOUNT_NAME=<your-va-name>
```

### Commission Rates
```bash
DEFAULT_COMMISSION_RATE_F1=10
DEFAULT_COMMISSION_RATE_F2=4
DEFAULT_COMMISSION_RATE_F3=2
DEFAULT_COMMISSION_RATE_F4=0
```

### Database
```bash
DATABASE_URL=<auto-injected-by-railway>
```

---

## ğŸ¯ Next Steps After Deployment

### 1. Get Your Backend URL

```bash
railway domain
```

Save this URL: `https://your-backend.up.railway.app`

### 2. Update CORS (After Deploying Frontend)

```bash
railway variables set CORS_ORIGIN="https://your-frontend.vercel.app,https://your-backend.up.railway.app"
```

### 3. Configure SePay Webhook

Go to: https://my.sepay.vn

**Settings â†’ Webhook:**
- URL: `https://your-backend.up.railway.app/api/v1/payment/sepay-webhook`
- Method: `POST`
- Authorization: `Apikey YOUR_SEPAY_API_KEY`

### 4. Deploy Frontend to Vercel

```bash
cd frontend

# Install Vercel CLI
npm install -g vercel

# Deploy
vercel

# Set environment
vercel env add VITE_API_URL production
# Enter: https://your-backend.up.railway.app/api/v1
```

### 5. Test End-to-End

```bash
# Run verification
./verify-deployment.sh

# Test health check
curl https://your-backend.up.railway.app/api/v1/health

# Monitor logs
railway logs --follow
```

---

## ğŸ› ï¸ Useful Commands

### View Logs
```bash
railway logs              # Recent logs
railway logs --follow     # Real-time logs
```

### Check Status
```bash
railway status            # Service status
railway variables         # List env variables
railway domain            # Show domain
```

### Manage Service
```bash
railway restart           # Restart service
railway open              # Open in browser
```

### Update Variables
```bash
railway variables set KEY=VALUE
railway variables delete KEY
```

---

## ğŸ”§ Troubleshooting

### Deployment Failed

**Check logs:**
```bash
railway logs
```

**Common issues:**
- Missing environment variables
- Database connection failed
- Build errors

**Fix:**
```bash
# Verify all variables are set
railway variables

# Restart service
railway restart

# Redeploy
cd backend
railway up --detach
```

### Database Issues

**Check DATABASE_URL:**
```bash
railway variables | grep DATABASE_URL
```

**Verify MySQL is running:**
```bash
railway status
```

**Run migrations manually:**
```bash
railway run npx prisma migrate deploy
```

### CORS Errors

**Update CORS_ORIGIN:**
```bash
railway variables set CORS_ORIGIN="https://your-frontend.vercel.app,https://your-backend.up.railway.app"
```

---

## ğŸ“ Important Files

| File | Purpose |
|------|---------|
| `deploy-railway.sh` | ğŸ¤– Automated deployment script |
| `verify-deployment.sh` | ğŸ” Deployment verification tool |
| `DEPLOY.md` | ğŸ“– Quick deployment guide |
| `README.md` | ğŸ“š Project overview & setup |
| `backend/railway.json` | âš™ï¸ Railway build configuration |
| `backend/.railwayignore` | ğŸš« Files to exclude from deploy |
| `backend/RAILWAY_DEPLOY_GUIDE.md` | ğŸ“‹ Detailed step-by-step guide |
| `backend/START_HERE.md` | ğŸ—ºï¸ Project navigation guide |

---

## âœ¨ What Makes This Automation Special

1. **One Command Deploy** - No manual Railway dashboard clicking
2. **Secure by Default** - Auto-generates cryptographic secrets
3. **Error Handling** - Checks prerequisites and validates setup
4. **Interactive Prompts** - Guides you through required inputs
5. **Complete Configuration** - Sets all 20+ environment variables
6. **Verification Tools** - Built-in deployment testing
7. **Clear Instructions** - Shows next steps after deployment
8. **Production Ready** - Includes security best practices

---

## ğŸ‰ You're Ready to Deploy!

1. Make sure Railway CLI is installed and logged in:
   ```bash
   railway login
   ```

2. Run the automation:
   ```bash
   ./deploy-railway.sh
   ```

3. Follow the prompts and let the script do the rest!

4. Verify deployment:
   ```bash
   ./verify-deployment.sh
   ```

---

## ğŸ“ Need Help?

**Check logs:**
```bash
railway logs
```

**View deployment guide:**
```bash
cat backend/RAILWAY_DEPLOY_GUIDE.md
```

**Railway dashboard:**
https://railway.app/dashboard

---

**Happy Deploying! ğŸš€**

Built with automation in mind for fast, secure, and reliable Railway deployments.
